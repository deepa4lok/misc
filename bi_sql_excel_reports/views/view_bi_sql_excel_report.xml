<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (C) 2021 - Today: Magnus (http://www.magnus.nl)
@author: Vincent Verheul (v.verheul@magnus.nl)
License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
-->

<odoo>
    <!-- Actions -->
    <act_window
        id="open_bi_sql_excel_reports"
        name="SQL Excel Reports definition"
        res_model="bi.sql.excel.report" />

    <!-- Module main menu entry -->
	<menuitem id="menu_bi_sql_excel_reports_main"
        name="SQL Excel Reports"
        parent = "base.next_id_9"
        action="open_bi_sql_excel_reports"
	    sequence="150"/>

    <!-- bi.sql.excel.report -->
    <record id="bi_sql_excel_report_view_form" model="ir.ui.view">
        <field name="name">Excel Report Form</field>
        <field name="model">bi.sql.excel.report</field>
        <field name="arch" type="xml">
        <form string="SQL Excel Report">
            <header>
                <!-- Header button or state indicator -->
            </header>
            <sheet>
                <h1>
                    <field name="name"/>
                </h1>
                <group>
                    <group>
                        <field name="sequence"/>
                        <field name="short_name" attrs="{'invisible':[('is_group', '=', True)]}"/>
                        <field name="description"/>
                    </group>
                    <group>
                        <field name="query_name" attrs="{'invisible':[('is_group', '=', True)]}"/>
                        <field name="is_group"/>
                        <field name="group_level" attrs="{'invisible':[('is_group', '=', False)]}"/>
                        <field name="filter_on_user" attrs="{'invisible':['|', ('is_group', '=', True),
                            ('is_select_index', '=', True)]}"/>
                        <field name="is_select_index"/>
                        <field name="active"/>
                    </group>
                </group>

                <notebook attrs="{'invisible':[('is_group', '=', True)]}">
                    <page string="Pivot Table" id="pivot_table" attrs="{'invisible':[('is_select_index', '=', True)]}">
                        <group>
                            <group>
                                <separator string="Pivot Table" colspan="2"/>
                                <field name="table_row"/>
                                <field name="table_col"/>
                                <field name="table_row_tot"/>
                                <field name="table_col_tot"/>
                            </group>
                            <group>
                                <separator string="Pivot Chart" colspan="2"/>
                                <field name="chart_type"/>
                                <field name="chart_left" attrs="{'invisible':[('chart_type', '=', False)]}"/>
                                <field name="chart_top" attrs="{'invisible':[('chart_type', '=', False)]}"/>
                                <field name="chart_width" attrs="{'invisible':[('chart_type', '=', False)]}"/>
                                <field name="chart_height" attrs="{'invisible':[('chart_type', '=', False)]}"/>
                                <field name="chart_scale" attrs="{'invisible':[('chart_type', '=', False)]}"/>
                            </group>
                        </group>
                    </page>
                    <page string="Fields" id="fields">
                        <field name="field_ids"/>
                    </page>
                </notebook>
            </sheet>
        </form>
        </field>
    </record>

    <record id="bi_sql_excel_report_view_tree" model="ir.ui.view">
        <field name="name">SQL Excel Reports List</field>
        <field name="model">bi.sql.excel.report</field>
        <field name="arch" type="xml">
            <tree string="Excel reports">
                <field name="id" invisible="1"/>
                <field name="sequence"/>
                <field name="name"/>
                <field name="is_group"/>
                <field name="group_level" attrs="{'invisible':[('is_group', '=', False)]}"/>
                <field name="is_select_index" attrs="{'invisible':[('is_group', '=', True)]}"/>
                <field name="short_name"/>
                <field name="query_name"/>
                <field name="chart_type"/>
            </tree>
        </field>
    </record>

    <record id="bi_sql_excel_report_view_search" model="ir.ui.view">
        <field name="name">SQL Excel Reports Search</field>
        <field name="model">bi.sql.excel.report</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="sequence"/>
                <field name="short_name"/>
                <field name="query_name"/>
                <field name="chart_type"/>
                <filter string="Reports only"
                    domain="[('is_select_index','=',False)]"/>
                <filter string="Selection Indexes only"
                    domain="[('is_select_index','=',True)]"/>
                <filter string="Having queries"
                    domain="[('query_name','!=',False)]"/>
                <filter string="Has only a pivot table"
                    domain="[('query_name','!=',False), ('chart_type','=',False), ('is_select_index','=',False)]"/>
            </search>
        </field>
    </record>

    <!-- bi.sql.excel.report.field -->
    <record id="bi_sql_excel_report_field_view_tree" model="ir.ui.view">
        <field name="name">SQL Excel Report Field List</field>
        <field name="model">bi.sql.excel.report.field</field>
        <field name="arch" type="xml">
            <tree string="Excel report fields">
                <field name="id" invisible="1"/>
                <field name="report_id" invisible="1"/>
                <field name="report_is_index" invisible="1"/>
                <field name="sequence"/>
                <field name="name"/>
                <field name="caption"/>
                <field name="pivot_area" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
<!--            <field name="filter_value" attrs="{'invisible':[('report_is_index', '=', True)]}"/>    -->
                <field name="global_filter" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
                <field name="subtotal" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
                <field name="show_details" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
<!--            <field name="is_user" attrs="{'invisible':[('report_is_index', '=', True)]}"/>         -->
                <field name="index_info" attrs="{'invisible':[('report_is_index', '=', False)]}"/>
            </tree>
        </field>
    </record>

    <record id="bi_sql_excel_report_field_view_form" model="ir.ui.view">
        <field name="name">SQL Excel Report Field Form</field>
        <field name="model">bi.sql.excel.report.field</field>
        <field name="arch" type="xml">
            <form>
                <field name="report_is_index" invisible="1"/>
                <group>
                    <group>
                        <separator string="Field" colspan="2"/>
                        <field name="sequence"/>
                        <field name="name"/>
                        <field name="caption"/>
                        <field name="pivot_area" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
                        <field name="formula" attrs="{'invisible':[('report_is_index', '=', True)]}"/>
                        <field name="format"/>
                    </group>
                    <group attrs="{'invisible':[('report_is_index', '=', True)]}">
                        <separator string="Field flags" colspan="2"/>
                        <field name="show_details"/>
                        <field name="subtotal"/>
                        <field name="is_user"/>
                    </group>
                </group>
                <group>
                    <group  attrs="{'invisible':[('report_is_index', '=', True)]}">
                        <separator string="Slicer" colspan="2"/>
                        <field name="slicer_top"/>
                        <field name="slicer_height"/>
                    </group>
                    <group  attrs="{'invisible':[('report_is_index', '=', False)]}">
                        <separator string="Index" colspan="2"/>
                        <field name="index_info"/>
                        <field name="index_field_width"/>
                    </group>
                    <group attrs="{'invisible':[('report_is_index', '=', True)]}">
                        <separator string="Filter" colspan="2"/>
                        <field name="filter_value"/>
                        <field name="global_filter"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
</odoo>
